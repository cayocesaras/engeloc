{% extends 'base.html' %}

{% block title %}Compras{% endblock %}

{% block content %}
    <div class="content" id="content">
      <h3 class="mt-4">Cadastro de Solicitação</h3>
        <form method="POST" id="form-solicitacao">
        {% csrf_token %}

        <!-- Campos do cabeçalho -->

        <div class="row">
                {% for field in form %}
                <div class="col-md-4 mb-2 form-floating">
                    {{ field }}
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                </div>
                {% endfor %}
        </div>

        <hr>

        <!-- Botão para abrir modal -->
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#itemModal">
            <i class="bi bi-plus-circle"></i> Adicionar Item
        </button>

        <br><br>

        <!-- Tabela de itens -->
            <div class="tab-content table-responsive" id="myTabContent">
                <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                    <table id="tabela-itens" class="table table-striped table-bordered">
                    <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantidade</th>
                        <th>Valor Unitário</th>
                        <th>Total</th>
                        <th>Ações</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>

        <!-- Campo escondido para enviar os itens em JSON -->
        <input type="hidden" name="itens_json" id="itens_json">

        <button type="submit" class="btn btn-success"><i class="bi bi-floppy"></i> Salvar Solicitação</button>
        </form>

<!-- Modal de adicionar item -->
<div class="modal fade" id="itemModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Adicionar Item</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label>Item</label>
          <select id="item" class="form-control">
            {% for i in itens %}
              <option value="{{ i.id }}">{{ i.descricao }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label>Quantidade</label>
          <input type="number" id="quantidade" class="form-control">
        </div>
        <div class="mb-3">
          <label>Valor Unitário</label>
          <input type="number" step="0.01" id="valor_unitario" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btn-add-item">Adicionar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}