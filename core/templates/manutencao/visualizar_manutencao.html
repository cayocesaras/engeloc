{% extends 'base.html' %}
{% block title %}Andamento da Manutenção{% endblock %}

{% block content %}
<div class="content">
  <h2 class="mt-4">Manutenção: {{ manutencao.produto }}</h2>
  <p><strong>Data de Início:</strong> {{ manutencao.data_inicio|date:"d/m/Y" }}</p>
  <p><strong>Observações:</strong> {{ manutencao.observacoes }}</p>

  <div class="progress mb-4" style="height: 30px;">
    <div class="progress-bar bg-success" role="progressbar" style="width: {{ progresso }}%;" aria-valuenow="{{ progresso }}" aria-valuemin="0" aria-valuemax="100">
      {{ progresso }}%
    </div>
  </div>
<div class="table-responsive">
  <table class="table table-bordered table-striped mt-4">
    <thead>
      <tr>
        <th>Ordem</th>
        <th>Etapa</th>
        <th>Prazo (dias)</th>
        <th>Data Prevista</th>
        <th>Data de Conclusão</th>
        <th>Status</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody>
      {% for etapa in etapas %}
        <tr>
        <td>{{ etapa.etapa.ordem }}</td>
        <td>{{ etapa.etapa.nome }}</td>
        <td>{{ etapa.etapa.prazo_dias }}</td>
        <td>{{ etapa.data_prevista|date:"d/m/Y" }}</td>
        <td>{{ etapa.data_conclusao|date:"d/m/Y" }}</td>
        <td>
          {% if etapa.status == 'concluida' %}
            <span class="badge bg-success">Concluída</span>
          {% else %}
            <span class="badge bg-warning text-dark">Pendente</span>
          {% endif %}
          {% if etapa.situacao == 'atrasada' %}
            <span class="badge bg-danger">Atrasada</span>
          {% elif etapa.situacao == 'no prazo' %}
            <span class="badge bg-primary">No prazo</span>
          {% else %}
            <span class="badge bg-secondary text-white">Em andamento</span>
          {% endif %}
        </td>
        <td>
        {% if etapa.status == 'concluida' %}
            
        {% else %}
            <form method="POST" action="{% url 'concluir_etapa' etapa.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-success text-white"
                    onclick="return confirm('Deseja marcar esta etapa como concluída?');">
                <i class="bi bi-check-circle"></i> Concluir
            </button>
            </form>
        {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

  <a href="{% url 'listagem_manutencao' %}" class="btn btn-secondary mt-3"><i class="bi bi-arrow-left-circle"></i> Voltar</a>
</div>
{% endblock %}
